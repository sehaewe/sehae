import{a as v,u as D,r as s,j as e}from"./index-BLJk-dj2.js";function T(){const{id:c}=v(),h=D(),[t,u]=s.useState({servicecode:"",idNumber:"",name:"",issueDate:"",startDate:"",endDate:"",duration:"",doctor:"",jobTitle:""}),[g,y]=s.useState(!0),[d,o]=s.useState(""),[l,x]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const r=await fetch(`/api/medical/${c}`);if(!r.ok)throw new Error("فشل جلب البيانات");const a=await r.json();u({servicecode:a.servicecode,idNumber:a.idNumber,name:a.name,issueDate:m(a.issueDate),startDate:m(a.startDate),endDate:m(a.endDate),duration:a.duration,doctor:a.doctor,jobTitle:a.jobTitle})}catch(r){o(r.message),console.error(r)}finally{y(!1)}})()},[c]);const m=i=>new Date(i).toISOString().split("T")[0],n=i=>{const{name:r,value:a}=i.target;u(p=>({...p,[r]:a}))},j=()=>{const i=new Date(t.startDate),r=new Date(t.endDate),a=Math.abs(r-i),p=Math.ceil(a/(1e3*60*60*24))+1;u(f=>({...f,duration:p}))};s.useEffect(()=>{t.startDate&&t.endDate&&j()},[t.startDate,t.endDate]);const b=async i=>{i.preventDefault(),x(!0),o("");try{const r=await fetch(`/api/medical/${c}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,duration:Number(t.duration)})});if(r.ok)alert("تم التعديل بنجاح!"),h("/MedicalDataForm");else{const a=await r.json();o(a.error||"فشل الحفظ")}}catch(r){o("خطأ في الاتصال بالخادم"),console.error(r)}finally{x(!1)}};return g?e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"جاري التحميل..."}):d?e.jsx("div",{style:{color:"red",padding:"2rem",textAlign:"center"},children:d}):e.jsxs("div",{style:{maxWidth:"600px",margin:"2rem auto",padding:"0 1rem"},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"1.5rem"},children:"تعديل السجل الطبي"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"رمز الخدمة"}),e.jsx("input",{type:"text",name:"servicecode",value:t.servicecode,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"رقم الهوية"}),e.jsx("input",{type:"text",name:"idNumber",value:t.idNumber,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"الاسم"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"تاريخ الإصدار"}),e.jsx("input",{type:"date",name:"issueDate",value:t.issueDate,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"يبدأ من"}),e.jsx("input",{type:"date",name:"startDate",value:t.startDate,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"حتى"}),e.jsx("input",{type:"date",name:"endDate",value:t.endDate,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"المدة (أيام)"}),e.jsx("input",{type:"number",name:"duration",value:t.duration,readOnly:!0,style:{width:"100%",padding:"8px",marginTop:"4px",backgroundColor:"#f0f0f0"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"اسم الطبيب"}),e.jsx("input",{type:"text",name:"doctor",value:t.doctor,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"المسمى الوظيفي"}),e.jsx("input",{type:"text",name:"jobTitle",value:t.jobTitle,onChange:n,required:!0,style:{width:"100%",padding:"8px",marginTop:"4px"}})]}),d&&e.jsx("p",{style:{color:"red",textAlign:"center"},children:d}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{type:"submit",disabled:l,style:{padding:"10px 20px",backgroundColor:l?"#ccc":"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:l?"not-allowed":"pointer"},children:l?"جاري الحفظ...":"حفظ التعديلات"})})]})]})}export{T as default};
